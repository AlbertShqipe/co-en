<%= render "shared/navbar"%>
  <div class="trio-forms">
    <% if current_user.role == "admin" %>
      <h1 style="text-align:center"><%= t('table.th2') %></h1>
      <div class="index-links-containers">
        <div class="link-container">
          <a href="/individual_forms"><%= t('table.th') %></a>
        </div>
        <div class="link-container">
          <a href="/duo"><%= t('table.th2') %></a>
        </div>
        <div class="link-container">
          <a href="/trios"><%= t('table.th3') %></a>
        </div>
        <div class="link-container">
          <a href="/group_forms"><%= t('table.th4') %></a>
        </div>
      </div>
    <% else %>
      <h1 style="text-align:center"><%= t('duo_form_index.title_f') %><%= current_user.name.capitalize %> <%= current_user.last_name.capitalize %><%= t('individual_form_index.title_en') %></h1>
    <% end %>
    <% if current_user.role == "competitor" && current_user.duos.present? %>
      <table class="table-form mx-auto">
        <thead>
          <tr style="width:50px">
            <th><%= t('index_duo.th.attributes') %></th>
            <% current_user.duos.each_with_index do |duo, index| %>
              <th><%= t('index_duo.th.duo_form') %> <%= index + 1 %></th>
            <% end %>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><%= t('index_duo.td.name_of_duo') %></td>
            <% current_user.duos.each do |duo| %>
              <td><%= duo.name %></td>
            <% end %>
          </tr>
          <tr>
            <td><%= t('index_duo.td.responsable') %></td>
            <% current_user.duos.each do |duo| %>
              <td><%= duo.responsable %></td>
            <% end %>
          </tr>
          <tr>
            <td><%= t('index_duo.td.group_address') %></td>
            <% current_user.duos.each do |duo| %>
              <td><%= duo.address %></td>
            <% end %>
          </tr>
          <tr>
            <td><%= t('index_duo.td.phone') %></td>
            <% current_user.duos.each do |duo| %>
              <td><%= duo.phone %></td>
            <% end %>
          </tr>
          <tr>
            <td><%= t('index_duo.td.email') %></td>
            <% current_user.duos.each do |duo| %>
              <td><%= duo.email %></td>
            <% end %>
          </tr>
          <tr>
            <td><%= t('index_duo.td.discipline') %></td>
            <% current_user.duos.each do |duo| %>
              <td><%= duo.discipline %></td>
            <% end %>
          </tr>
          <tr>
            <td><%= t('index_duo.td.level') %></td>
            <% current_user.duos.each do |duo| %>
              <td><%= duo.level %></td>
            <% end %>
          </tr>
          <tr>
            <td><%= t('index_duo.td.music') %></td>
            <% current_user.duos.each do |duo| %>
              <td><%= duo.title_of_music %></td>
            <% end %>
          </tr>
          <tr>
            <td><%= t('index_duo.td.composer') %></td>
            <% current_user.duos.each do |duo| %>
              <td><%= duo.composer %></td>
            <% end %>
          </tr>
          <tr>
            <td><%= t('index_duo.td.length_of_piece') %></td>
            <% current_user.duos.each do |duo| %>
              <td><%= duo.length_of_piece %></td>
            <% end %>
          </tr>
          <tr>
            <td><b><%= t('index_duo.td.participant_name_lastName') %></b></td>
            <% current_user.duos.each do |duo| %>
              <% duo.duo_participants.each do |participant| %>
                <td>
                  <% if participant.photo.attached? %>
                    <%= cl_image_tag participant.photo.key, height: 30, width: 20, fetch_format: "auto", page: 1  %> <%= participant.name %> <%= participant.last_name %>
                  <% else %>
                    <p>Participant has no picture attached</p>
                  <% end %>
                </td>
              <% end %>
            <% end %>
          </tr>
          <tr>
            <td><%= t('index_duo.td.participant_age') %></td>
            <% current_user.duos.each do |duo| %>
              <% duo.duo_participants.each do |participant| %>
                <td>
                  <%= participant.birth_date %><br>
                  <%= calculate_age(participant.birth_date) %> years old
                </td>
              <% end %>
            <% end %>
          </tr>
        </tbody>
      </table>
    <% elsif current_user.role == "admin" && @duos.present?%>
      <div class="filter">
        <%= form_with url: duo_index_path, method: :get, local: true do |form| %>
          <div>
            <%# Playing with the grid in bootstrap %>
            <div class="row">
              <div class="col-sm" style="margin-top:20px">
                <h4>Filtrer par Niveau</h4>
                <%# 'Préparatoire', 'Elémentaire', 'Moyen', 'Supérieur', 'Formation'%>
                <div style="display:grid; grid-template-columns: auto auto; justify-content: space-evenly">
                  <div style="text-align: left; padding-right:15px">
                    <div>
                      <%= form.check_box :level, { multiple: true }, "Préparatoire", nil %> Préparatoire
                    </div>
                    <div>
                      <%= form.check_box :level, { multiple: true }, "Elémentaire", nil %> Elémentaire
                    </div>
                  </div>
                  <div style="text-align: left; padding-right:15px">
                    <div>
                      <%= form.check_box :level, { multiple: true }, "Moyen", nil %> Moyen
                    </div>
                                        <div>
                      <%= form.check_box :level, { multiple: true }, "Supérieur", nil %> Supérieur
                    </div>
                    <div>
                      <%= form.check_box :level, { multiple: true }, "Formation", nil %> Formation
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-sm" style="margin-top:20px">
                <h4>Filtrer par Style</h4>
                <div style="display: flex; justify-content: center">
                  <div style="margin-right: 30px;">
                    <%= form.check_box :style, { multiple: true }, "Classique", nil %> Classique
                  </div>
                  <div style="margin-right: 30px;">
                    <%= form.check_box :style, { multiple: true }, "Modern’Jazz", nil %> Modern’Jazz
                  </div>
                  <div style="margin-right: 30px;">
                    <%= form.check_box :style, { multiple: true }, "Contemporain", nil %> Contemporain
                  </div>
                  <div>
                    <%= form.check_box :style, { multiple: true }, "Caractère", nil %> Caractère
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <!-- Date Filters -->
              <div class="col-sm" style="margin-top:20px">
                <h4>Filtrer par Date</h4>
                  <div>
                    <label for="start_date">À partir de:</label>
                    <%= form.date_field :start_date, value: params[:start_date] %>
                  </div>
              </div>
            </div>

          </div>
          <div>
            <%= form.submit "Filtrer" %>
          </div>
        <% end %>
      </div>

      <div class="table-con">
        <% @duos.each_with_index do |duo, index| %>
          <table class="table-form mx-auto" id="table<%=index + 1%>">
            <thead>
              <tr style="width:50px">
                <th><%= t('index_duo.th.attributes') %></th>
                <th width="40%"><%= t('index_duo.th.duo_form') %> <%= index + 1 %></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><%= t('index_duo.td.name_of_duo') %></td>
                <td><%= duo.name %></td>
              </tr>
              <tr>
                <td><%= t('index_duo.td.responsable') %></td>
                <td><%= duo.responsable %></td>
              </tr>
              <tr>
                <td><%= t('index_duo.td.duo_address') %></td>
                <td><%= duo.address %></td>
              </tr>
              <tr>
                <td><%= t('index_duo.td.phone') %></td>
                <td><%= duo.phone %></td>
              </tr>
              <tr>
                <td><%= t('index_duo.td.email') %></td>
                <td><%= duo.email %></td>
              </tr>
              <tr>
                <td><%= t('index_duo.td.discipline') %></td>
                <td><%= duo.discipline %></td>
              </tr>
              <tr>
                <td><%= t('index_duo.td.level') %></td>
                <td><%= duo.level %></td>
              </tr>
              <tr>
                <td><%= t('index_duo.td.music') %></td>
                <td><%= duo.title_of_music %></td>
              </tr>
              <tr>
                <td><%= t('index_duo.td.composer') %></td>
                <td><%= duo.composer %></td>
              </tr>
              <tr>
                <td><%= t('index_duo.td.length_of_piece') %></td>
                <td><%= duo.length_of_piece %></td>
              </tr>
              <tr>
                <td><%= t("index_individuals.td.created_at") %></td>
                <td><%= duo.created_at.strftime("%d-%m-%Y") %></td>
              </tr>
              <tr>
                <th><b><%= t('index_duo.td.participant_name_lastName') %></b></th>
                <% duo.duo_participants.each_with_index do |participant, index| %>
                  <th width="40%"><%= t('index_duo.td.participant_name_lastName') %> <%= index + 1 %></th>
                <% end %>
              </tr>
              <tr>
                <td><b><%= t('index_duo.td.participant_name_lastName') %></b></td>
                <% duo.duo_participants.each_with_index do |participant, index| %>
                  <td><%= participant.name %> <%= participant.last_name %></td>
                <% end %>
              </tr>
              <tr>
                <td><%= t('index_duo.td.profile_pic') %></td>
                <% duo.duo_participants.each_with_index do |participant, index| %>
                  <td>
                    <% if participant.photo.attached? %>
                      <%= cl_image_tag participant.photo.key, height: 30, width: 20, fetch_format: "auto", page: 1  %> <%= participant.name %>
                    <% else %>each do |participant|
                      <p>Le candidat n'a pas de photo</p>
                    <% end %>
                  </td>
                <% end %>
              </tr>
              <tr>
                <td><%= t('index_groups.td.participant_age') %></td>
                <% duo.duo_participants.each_with_index do |participant, index| %>
                  <td>
                    <%= participant.birth_date %>
                  </td>
                <% end %>
              </tr>
              <tr>
                <td><%= t("index_individuals.td.age_day_competition") %></td>
                <% duo.duo_participants.each_with_index do |participant, index| %>
                  <td>
                    <%= calculate_age(participant.birth_date) %>
                  </td>
                <% end %>
              </tr>
              <tr>
                <td><%= t('index_duo.td.file') %></td>
                <% duo.duo_participants.each_with_index do |participant, index| %>
                  <td>
                    <% if participant.file.attached? %>
                      <% key = participant.file.key %>
                      <% key %>
                      <% matching_file = @results_prod.find { |hash| hash["public_id"] == "production/#{key}" } %>
                      <% if matching_file != nil %>
                        <% newkey =  matching_file["asset_id"] %>
                        <%= link_to "Download", "https://res-console.cloudinary.com/dsyp2wb4w/media_explorer_thumbnails/#{newkey}/download" %>
                        <% else %>
                        <p>Aucun fichier correspondant trouvé.</p>
                      <% end %>
                    <% end %>
                  </td>
                <% end %>
              </tr>
              <tr>
                <td><%= t('index_duo.td.file1') %></td>
                <% duo.duo_participants.each_with_index do |participant, index| %>
                    <td>
                      <% if participant.id_card.attached? %>
                        <% key = participant.id_card.key %>
                        <% matching_file = @results_prod.find { |hash| hash["public_id"] == "production/#{key}" } %>
                        <% if matching_file != nil %>
                          <% newkey =  matching_file["asset_id"] %>
                          <%= link_to "Download", "https://res-console.cloudinary.com/dsyp2wb4w/media_explorer_thumbnails/#{newkey}/download" %>
                          <% else %>
                          <p>Aucun fichier correspondant trouvé.</p>
                        <% end %>
                      <% end %>
                    </td>
                <% end %>
              </tr>
            </tbody>
          </table>
        <% end %>
      </div>
    <% else %>
      <div class="d-flex justify-content-center">
        <h3 style="color:white"><%= t("duo_form_index.text").html_safe %></h3>
      </div>
    <% end %>
  </div>
<%= @duos.empty? ? render("shared/footer_fixed") : render("shared/footer") %>
